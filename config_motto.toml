version = "1.1"

[vars]
plant = "LAB-01"
line = "stain-processor"
operator = "auto"
default_port = "COM4"
default_baudrate = 115200

[profiles.default]
name = "default"
extends = ""

[profiles.default.env]
port = "COM4"
baudrate = 115200
timeout = 1.0
safety_mode = "normal"
max_retries = 3

[profiles.default.metadata]

[contexts.run_env]
name = "run_env"
zones = "0010"
operator = "auto"
safety_mode = "normal"

[contexts.run_env.metadata]

[conditions.no_alarms]
name = "no_alarms"
expr = "status(\"alarm\") == 0"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ñ Ð°Ð²Ð°Ñ€Ð¸Ð¹"

[conditions.no_alarms.metadata]

[conditions.serial_connected]
name = "serial_connected"
expr = "status(\"serial\") == \"connected\""
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº UART"

[conditions.serial_connected.metadata]

[conditions.temp_safe]
name = "temp_safe"
expr = "sensor(\"temp.C\") >= 5 and sensor(\"temp.C\") <= 60"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð¹ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹"

[conditions.temp_safe.metadata]

[conditions.pressure_safe]
name = "pressure_safe"
expr = "sensor(\"press.kPa\") >= 30 and sensor(\"press.kPa\") <= 300"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð³Ð¾ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ"

[conditions.pressure_safe.metadata]

[conditions.movement_complete]
name = "movement_complete"
expr = "status(\"movement\") == \"complete\""
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ"

[conditions.movement_complete.metadata]

[conditions.pump_ready]
name = "pump_ready"
expr = "status(\"pump\") == \"ready\""
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð½Ð°ÑÐ¾ÑÐ°"

[conditions.pump_ready.metadata]

[guards.no_alarms]
name = "no_alarms"
when = "pre"
condition = "no_alarms"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ñ Ð°Ð²Ð°Ñ€Ð¸Ð¹ Ð¿ÐµÑ€ÐµÐ´ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼"

[guards.no_alarms.on_fail]
action = "abort"
reason = "Active alarms detected"

[guards.no_alarms.metadata]

[guards.serial_connected]
name = "serial_connected"
when = "pre"
condition = "serial_connected"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº UART"

[guards.serial_connected.on_fail]
action = "retry"
max_attempts = 3
cooldown_ms = 1000

[guards.serial_connected.metadata]

[guards.temp_safe]
name = "temp_safe"
when = "pre"
condition = "temp_safe"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð¹ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹"

[guards.temp_safe.on_fail]
action = "cooldown_then_retry"
cooldown_ms = 5000
max_attempts = 3

[guards.temp_safe.metadata]

[guards.pressure_safe]
name = "pressure_safe"
when = "pre"
condition = "pressure_safe"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð³Ð¾ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ"

[guards.pressure_safe.on_fail]
action = "abort"
reason = "Pressure out of safe range"

[guards.pressure_safe.metadata]

[guards.movement_complete]
name = "movement_complete"
when = "post"
condition = "movement_complete"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ"

[guards.movement_complete.on_fail]
action = "retry"
max_attempts = 2

[guards.movement_complete.metadata]

[guards.pump_ready]
name = "pump_ready"
when = "pre"
condition = "pump_ready"
description = "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð½Ð°ÑÐ¾ÑÐ°"

[guards.pump_ready.on_fail]
action = "wait"
timeout_ms = 10000

[guards.pump_ready.metadata]

[policies.safe_retry]
name = "safe_retry"
retry_on = [
    "timeout",
    "serial_error",
    "movement_error",
]
max_attempts = 3
step_timeout_ms = 60000
sequence_timeout_ms = 600000

[policies.safe_retry.backoff]
type = "exponential"
base_ms = 500
factor = 2.0
jitter = "full"

[policies.safe_retry.metadata]

[policies.fast_retry]
name = "fast_retry"
retry_on = [
    "timeout",
]
max_attempts = 2
step_timeout_ms = 30000
sequence_timeout_ms = 300000

[policies.fast_retry.backoff]
type = "linear"
base_ms = 1000

[policies.fast_retry.metadata]

[resources.serial_port]
name = "serial_port"
type = "mutex"
members = [
    "COM3",
    "COM4",
    "COM5",
]
scope = "machine"

[resources.serial_port.metadata]

[resources.pump]
name = "pump"
type = "mutex"
members = [
    "pump_main",
]
scope = "machine"

[resources.pump.metadata]

[resources.valves]
name = "valves"
type = "semaphore"
capacity = 4

[resources.valves.metadata]

[resources.movement]
name = "movement"
type = "mutex"
members = [
    "multi",
    "rright",
    "clamp",
]
scope = "machine"

[resources.movement.metadata]

[events.estop]
name = "estop"
source = "hardware"
filter = "status(\"estop\") == 1"
description = "ÐÐ²Ð°Ñ€Ð¸Ð¹Ð½Ð°Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°"

[events.estop.metadata]

[events.overtemp]
name = "overtemp"
source = "sensor"
filter = "sensor(\"temp.C\") > 60"
description = "ÐŸÐµÑ€ÐµÐ³Ñ€ÐµÐ²"

[events.overtemp.metadata]

[events.press_drop]
name = "press_drop"
source = "sensor"
filter = "sensor(\"press.kPa\") < 30 for 3s"
description = "ÐŸÐ°Ð´ÐµÐ½Ð¸Ðµ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ"

[events.press_drop.metadata]

[events.serial_error]
name = "serial_error"
source = "system"
filter = "status(\"serial\") == \"error\""
description = "ÐžÑˆÐ¸Ð±ÐºÐ° UART"

[events.serial_error.metadata]

[events.movement_error]
name = "movement_error"
source = "system"
filter = "status(\"movement\") == \"error\""
description = "ÐžÑˆÐ¸Ð±ÐºÐ° Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ"

[events.movement_error.metadata]

[handlers.on_estop]
name = "on_estop"
on = "estop"
do = [
    "EMERGENCY_STOP",
    "CLOSE_ALL_VALVES",
    "POWER_OFF_PUMP",
]
priority = 100
description = "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð°Ð²Ð°Ñ€Ð¸Ð¹Ð½Ð¾Ð¹ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸"

[handlers.on_estop.metadata]

[handlers.on_overtemp]
name = "on_overtemp"
on = "overtemp"
do = [
    "POWER_OFF_HEATERS",
    "OPEN_DRAIN",
    "ALERT_OPERATOR",
]
priority = 80
description = "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿ÐµÑ€ÐµÐ³Ñ€ÐµÐ²Ð°"

[handlers.on_overtemp.metadata]

[handlers.on_pressdrop]
name = "on_pressdrop"
on = "press_drop"
do = [
    "OPEN_DRAIN",
    "CHECK_PUMP_STATUS",
    "ALERT_OPERATOR",
]
priority = 70
description = "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ð°Ð´ÐµÐ½Ð¸Ñ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ"

[handlers.on_pressdrop.metadata]

[handlers.on_serial_error]
name = "on_serial_error"
on = "serial_error"
do = [
    "RECONNECT_SERIAL",
    "RETRY_COMMAND",
]
priority = 50
description = "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±ÐºÐ¸ UART"

[handlers.on_serial_error.metadata]

[handlers.on_movement_error]
name = "on_movement_error"
on = "movement_error"
do = [
    "STOP_MOVEMENT",
    "HOME_AXIS",
    "RETRY_MOVEMENT",
]
priority = 60
description = "ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ"

[handlers.on_movement_error.metadata]

[commands]
multi_og = "sm -8 * * * *"
multi_flush_og = "sm -43 * * * *"
multi_ea = "sm 95 * * * *"
multi_flush_ea = "sm 61 * * * *"
multi_gemo = "sm -77 * * * *"
multi_flush_gemo = "sm -43 * * * *"
multi_alco = "sm 26 * * * *"
multi_flush_alco = "sm 61 * * * *"
multi_water = "sm -111 * * * *"
multi_flush_water = "sm -145 * * * *"
multi_chlor = "sm -214 * * * *"
multi_flush_chlor = "sm -180 * * * *"
rright_drain = "sm * * 4 * *"
rright_exposure = "sm * * 53 * *"
rright_up = "sm * * -53 * *"
rright_load_tubes = "sm * * 43 * *"
rright_extract_tubes = "sm * * -3 * *"
rright_pre_zero = "sm * * 130 * *"
home_multi = "sh 1 0 0 0 0"
home_rright = "sh 0 0 1 0 0"
home_clamp = "clamph"
clamp_close = "sm * * * 140 140"
clamp_open = "sm * * * 0 0"
kl1_on = "pon 1"
kl1_off = "poff 1"
kl2_on = "pon 2"
kl2_off = "poff 2"
pump_on = "pon 0"
pump_off = "poff 0"
test_command = "test"
system_status = "status"

[sequences.load_tubes]
name = "load_tubes"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ load_tubes"
type = "sequence"
steps = [
    "Clamp â†’ ÑÐ¶Ð°Ñ‚ÑŒ ",
    "Clamp â†’ Ñ€Ð°Ð·Ð¶Ð°Ñ‚ÑŒ",
    "RRight â†’ Ð¿Ñ€ÐµÐ´Ð½Ð¾Ð»ÑŒ",
    "wait 3",
    "Ð¥Ð¾Ð¼Ð¸Ð½Ð³ RRight",
    "RRight â†’ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð¸Ñ€Ð¾Ðº",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.load_tubes.metadata]

[sequences.load_samples]
name = "load_samples"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ load_samples"
type = "sequence"
steps = [
    "RRight â†’ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð¸Ñ€Ð¾Ðº",
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "wait 10",
    "RRight â†’ Ð¸Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð¸Ñ€Ð¾Ðº",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.load_samples.metadata]

[sequences.load_slides]
name = "load_slides"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ load_slides"
type = "sequence"
steps = [
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "Clamp â†’ Ñ€Ð°Ð·Ð¶Ð°Ñ‚ÑŒ",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.load_slides.metadata]

[sequences.coloring]
name = "coloring"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ coloring"
type = "sequence"
steps = [
    "Clamp â†’ ÑÐ¶Ð°Ñ‚ÑŒ ",
    "sedimantation",
    "alco",
    "gemo",
    "water",
    "water",
    "og",
    "alco",
    "ea",
    "alco",
    "alco",
    "alco",
    "waste_out",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.coloring.metadata]

[sequences.og]
name = "og"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ og"
type = "sequence"
steps = [
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "Multi â†’ OG",
    "ÐÐ°ÑÐ¾Ñ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 2",
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° OG",
    "wait 3",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "ÐÐ°ÑÐ¾Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "RRight â†’ ÑÐºÑÐ¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
    "waste_out",
    "waste",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.og.metadata]

[sequences.ea]
name = "ea"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ ea"
type = "sequence"
steps = [
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "Multi â†’ EA",
    "ÐÐ°ÑÐ¾Ñ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 2",
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° EA",
    "wait 3",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "ÐÐ°ÑÐ¾Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "RRight â†’ ÑÐºÑÐ¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
    "wait 90",
    "waste_out",
    "waste",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.ea.metadata]

[sequences.gemo]
name = "gemo"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ gemo"
type = "sequence"
steps = [
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "Multi â†’ Gemo",
    "ÐÐ°ÑÐ¾Ñ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 1",
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° Gemo",
    "wait 1",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "ÐÐ°ÑÐ¾Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "RRight â†’ ÑÐºÑÐ¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
    "wait 50",
    "waste_out",
    "waste",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.gemo.metadata]

[sequences.alco]
name = "alco"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ alco"
type = "sequence"
steps = [
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "Multi â†’ Alco",
    "ÐÐ°ÑÐ¾Ñ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 2",
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° Alco",
    "wait 3",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "ÐÐ°ÑÐ¾Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "RRight â†’ ÑÐºÑÐ¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
    "waste_out",
    "waste",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.alco.metadata]

[sequences.water]
name = "water"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ water"
type = "sequence"
steps = [
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "Multi â†’ Water",
    "ÐÐ°ÑÐ¾Ñ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 1",
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° Water",
    "wait 1",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "ÐÐ°ÑÐ¾Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "RRight â†’ ÑÐºÑÐ¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
    "wait 30",
    "waste_out",
    "waste",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.water.metadata]

[sequences.chlor]
name = "chlor"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ chlor"
type = "sequence"
steps = [
    "RRight â†’ Ð²ÐµÑ€Ñ…",
    "Multi â†’ Chlor",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 1",
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° Chlor",
    "wait 1",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "ÐÐ°ÑÐ¾Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "RRight â†’ ÑÐºÑÐ¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
    "waste_out",
    "waste",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.chlor.metadata]

[sequences.sedimantation]
name = "sedimantation"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ sedimantation"
type = "sequence"
steps = [
    "Ð¥Ð¾Ð¼Ð¸Ð½Ð³ Multi",
    "wait 3",
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° Alco",
    "RRight â†’ ÑÐºÑÐ¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ",
    "wait 300",
    "RRight â†’ ÑÐ»Ð¸Ð²",
    "waste",
    "waste_out",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.sedimantation.metadata]

[sequences.waste]
name = "waste"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ waste"
type = "sequence"
steps = [
    "RRight â†’ ÑÐ»Ð¸Ð²",
    "ÐÐ°ÑÐ¾Ñ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 1",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 6",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "ÐÐ°ÑÐ¾Ñ Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.waste.metadata]

[sequences.waste_out]
name = "waste_out"
description = "ÐŸÐ¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ waste_out"
type = "sequence"
steps = [
    "Multi â†’ Ð¿Ñ€Ð¾Ð´ÑƒÐ²ÐºÐ° OG",
    "KL1 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "KL2 Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "wait 8",
    "KL1 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
    "KL2 Ð²Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",
]
policy = "safe_retry"
guards = [
    "no_alarms",
    "serial_connected",
]
post_checks = [
    "movement_complete",
]

[sequences.waste_out.metadata]

[templates]

[units]
duration = [
    "ms",
    "s",
    "min",
]
temperature = [
    "C",
    "K",
]
pressure = [
    "kPa",
    "bar",
]
position = [
    "steps",
    "mm",
    "degrees",
]

[validators.temp_work_range]
name = "temp_work_range"
key = "sensor(temp.C)"
description = "Ð Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹"

[validators.temp_work_range.range]
min = 5
max = 60

[validators.temp_work_range.metadata]

[validators.press_safe]
name = "press_safe"
key = "sensor(press.kPa)"
description = "Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹ Ð´Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ"

[validators.press_safe.range]
min = 30
max = 300

[validators.press_safe.metadata]

[runtime]
profile = "default"
start = "load_tubes"

[runtime.args]

[audit]
log_level = "info"
trace_context = true
snapshots = "on_error"
metrics_enabled = true

[serial_default]
port = "COM4"
baudrate = 115200
bytesize = 8
parity = "N"
stopbits = 1
timeout = 1.0

[[wizard.step]]
id = 1
title = "Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ"
buttons = [
    { text = "â–¶ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¾ÐºÑ€Ð°ÑÐºÑƒ Ð¸ Ð¾ÑÐ°Ð¶Ð´ÐµÐ½Ð¸Ðµ", next = 2 },
    { text = "â–¶ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¼Ñ‹Ð²ÐºÑƒ", next = 7 },
]
sequence = ""
autoNext = false
showBar = false
melodyEnter = ""
melodyExit = ""

[[wizard.step]]
id = 2
title = "Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹"
buttons = [
    { text = "Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ", next = 1 },
]
sequence = "load_tubes"
autoNext = 3
showBar = true
melodyEnter = ""
melodyExit = ""

[[wizard.step]]
id = 3
title = "Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð±Ð¸Ñ€ÐºÐ¸ Ñ Ð¾Ð±Ñ€Ð°Ð·Ñ†Ð°Ð¼Ð¸"
buttons = [
    { text = "â–¶ Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð·Ñ†Ñ‹", next = 4 },
]
sequence = ""
autoNext = false
showBar = false
melodyEnter = "melodies/zvuk-na-trube.wav"
melodyExit = ""

[[wizard.step]]
id = 4
title = "Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¾Ð±Ñ€Ð°Ð·Ñ†Ð¾Ð²"
buttons = []
sequence = "load_samples"
autoNext = 5
showBar = true
melodyEnter = ""
melodyExit = ""

[[wizard.step]]
id = 5
title = "Ð˜Ð·Ð²Ð»ÐµÐºÐ¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð±Ð¸Ñ€ÐºÐ¸"
buttons = [
    { text = "â–¶ ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ", next = 6 },
]
sequence = ""
autoNext = false
showBar = false
melodyEnter = "melodies/zvuk-na-trube.wav"
melodyExit = ""

[[wizard.step]]
id = 6
title = "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÑ‚ÐµÐºÐ»Ð°"
buttons = [
    { text = "â–¶ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¾ÑÐ°Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¸ Ð¾ÐºÑ€Ð°ÑÐºÑƒ", next = 7 },
]
sequence = ""
autoNext = false
showBar = false
melodyEnter = ""
melodyExit = ""

[[wizard.step]]
id = 7
title = "ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¾ÑÐ°Ð¶Ð´ÐµÐ½Ð¸Ñ Ð¸ Ð¾ÐºÑ€Ð°ÑÐºÐ¸"
buttons = []
sequence = "coloring"
autoNext = 8
showBar = true
melodyEnter = ""
melodyExit = ""

[[wizard.step]]
id = 8
title = "ÐžÐºÑ€Ð°ÑÐºÐ° Ð·Ð°ÐºÐ¾Ð½Ñ‡ÐµÐ½Ð°"
buttons = [
    { text = "ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ", next = 1 },
]
sequence = ""
autoNext = false
showBar = false
melodyEnter = "melodies/zvuk-na-trube.wav"
melodyExit = ""
