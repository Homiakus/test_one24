# MOTTO - Machine Orchestration in TOML

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

MOTTO (Machine Orchestration in TOML) - —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install tomli tomli-w pytest

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
git clone <repository>
cd <project>
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### 1. –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è config.toml –≤ MOTTO —Ñ–æ—Ä–º–∞—Ç
python create_motto_config.py config.toml

# –†–µ–∑—É–ª—å—Ç–∞—Ç: config_motto.toml
```

#### 2. –ó–∞–≥—Ä—É–∑–∫–∞ MOTTO –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```python
from core.motto import MOTTOParser

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
parser = MOTTOParser()
config = parser.parse_config('config_motto.toml')

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
print(f"MOTTO Version: {config.version}")

# –î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º
print(f"Available commands: {len(config.vars)}")

# –î–æ—Å—Ç—É–ø –∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º
print(f"Available sequences: {list(config.sequences.keys())}")
```

#### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
python test_motto_basic.py
python test_motto_migration.py
```

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- **–ì–≤–∞—Ä–¥—ã**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- **–£—Å–ª–æ–≤–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- **–ü–æ–ª–∏—Ç–∏–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ç—Ä–∞–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

### üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏
- **–ú—å—é—Ç–µ–∫—Å—ã**: –ó–∞—â–∏—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- **–°–µ–º–∞—Ñ–æ—Ä—ã**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UART

### üì° –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
- **–°–æ–±—ã—Ç–∏—è**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**: –ò–µ—Ä–∞—Ä—Ö–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### ‚öôÔ∏è –ü—Ä–æ—Ñ–∏–ª–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã
- **–ü—Ä–æ—Ñ–∏–ª–∏**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
‚îú‚îÄ‚îÄ config.toml              # –ò—Å—Ö–æ–¥–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è v1.0
‚îú‚îÄ‚îÄ config_motto.toml        # MOTTO –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è v1.1
‚îú‚îÄ‚îÄ core/motto/              # –ú–æ–¥—É–ª—å MOTTO
‚îÇ   ‚îú‚îÄ‚îÄ types.py            # –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ parser.py           # –ü–∞—Ä—Å–µ—Ä TOML
‚îÇ   ‚îú‚îÄ‚îÄ compatibility.py    # –ê–¥–∞–ø—Ç–µ—Ä —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ ...                 # –î—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ create_motto_config.py  # –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_motto_*.py         # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ DocsPro/                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å v1.0 –Ω–∞ v1.1

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ MOTTO –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
python create_motto_config.py config.toml

# –†–µ–∑—É–ª—å—Ç–∞—Ç: config_motto.toml —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π MOTTO
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

1. **–ö–æ–º–∞–Ω–¥—ã**: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º—ë–Ω (—Ä—É—Å—Å–∫–∏–π ‚Üí –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
2. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–≤–∞—Ä–¥–æ–≤ –∏ –ø–æ–ª–∏—Ç–∏–∫
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–∏–ª—è—Ö
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

**v1.0 (config.toml)**:
```toml
[buttons]
"Multi ‚Üí OG" = "sm -8 * * * *"
"KL1 –≤–∫–ª—é—á–∏—Ç—å" = "pon 1"

[sequences]
og = ["RRight ‚Üí –≤–µ—Ä—Ö", "Multi ‚Üí OG", "–ù–∞—Å–æ—Å –≤–∫–ª—é—á–∏—Ç—å"]
```

**v1.1 (config_motto.toml)**:
```toml
[commands]
multi_og = "sm -8 * * * *"
kl1_on = "pon 1"

[sequences.og]
name = "og"
steps = ["rright_up", "multi_og", "pump_on"]
policy = "safe_retry"
guards = ["no_alarms", "serial_connected"]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã MOTTO
python test_motto_basic.py

# –¢–µ—Å—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏
python test_motto_migration.py

# –í—Å–µ —Ç–µ—Å—Ç—ã
python -m pytest test_motto_*.py -v
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

```
test_motto_basic.py: 9/9 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
test_motto_migration.py: 6/6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- **–ö–æ–º–∞–Ω–¥**: 31 (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π**: 13 (—Å –≥–≤–∞—Ä–¥–∞–º–∏)
- **–£—Å–ª–æ–≤–∏–π**: 6 (–ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
- **–ì–≤–∞—Ä–¥–æ–≤**: 6 (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- **–ü–æ–ª–∏—Ç–∏–∫**: 2 (retry —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
- **–†–µ—Å—É—Ä—Å–æ–≤**: 4 (–º—å—é—Ç–µ–∫—Å—ã/—Å–µ–º–∞—Ñ–æ—Ä—ã)
- **–°–æ–±—ã—Ç–∏–π**: 5 (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**: 5 (—Ä–µ–∞–∫—Ü–∏–∏)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ MOTTO

```toml
# –í–µ—Ä—Å–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞
version = "1.1"

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
[vars]
plant = "LAB-01"
default_port = "COM4"

# –ü—Ä–æ—Ñ–∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
[profiles.default]
env = { port = "COM4", timeout = 1.0 }

# –£—Å–ª–æ–≤–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
[conditions.no_alarms]
expr = 'status("alarm") == 0'

# –ì–≤–∞—Ä–¥—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
[guards.no_alarms]
when = "pre"
condition = "no_alarms"
on_fail = { action = "abort" }

# –ü–æ–ª–∏—Ç–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
[policies.safe_retry]
max_attempts = 3
backoff = { type = "exponential" }

# –†–µ—Å—É—Ä—Å—ã –∏ –º—å—é—Ç–µ–∫—Å—ã
[resources.serial_port]
type = "mutex"
members = ["COM3", "COM4", "COM5"]

# –°–æ–±—ã—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã
[events.estop]
source = "hardware"
filter = 'status("estop") == 1'

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
[handlers.on_estop]
on = "estop"
do = ["EMERGENCY_STOP"]
priority = 100

# –ö–æ–º–∞–Ω–¥—ã
[commands]
multi_og = "sm -8 * * * *"

# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
[sequences.og]
steps = ["multi_og", "pump_on"]
policy = "safe_retry"
guards = ["no_alarms"]
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

1. **–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ TOML**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å TOML
   python -c "import tomli; tomli.load(open('config.toml', 'rb'))"
   ```

2. **–û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**
   ```bash
   # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
   python migrate_simple.py config.toml
   ```

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π**
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –≤ UTF-8
   file config.toml
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MOTTO](DocsPro/03_Design/architecture.md)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏](DocsPro/09_Reports/motto_integration_report.md)
- [–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞](DocsPro/00_Charter/goal.md)
- [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π](config_motto_example.toml)

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `python test_motto_basic.py`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: `python test_motto_migration.py`
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ `DocsPro/`

---

**–í–µ—Ä—Å–∏—è**: MOTTO v1.1  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é  
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: 100% —Å config.toml v1.0