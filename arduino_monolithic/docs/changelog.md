# Changelog - Система управления 5-моторным контроллером

## [2024-12-19] - Добавление мониторинга пинов и функционала весов

### Добавлено
- **Мониторинг входных пинов** с битовой маской через команду `read_pins`
- **Интеграция датчика веса HX711** с полным функционалом измерений
- **Мониторинг переполненности резервуара** через пин WASTE по запросу
- **Новые команды мониторинга**: `read_pins`, `check_overflow`
- **Команды для работы с весами**: `start_weight`, `stop_weight`, `get_weight`, `zero_weight`, `calibrate_weight`
- **8 входных пинов** для мониторинга системы (пины 3,4,5,6,7,9,11,12)
- **Структуры данных** для управления весами и входными пинами
- **Система безопасности** с таймаутами для измерения веса
- **Калибровка датчика веса** с известным весом

### Технические детали
- Добавлена библиотека HX711 v0.7.5
- Входные пины настроены с подтяжкой (INPUT_PULLUP)
- Битовая маска отображается в формате 00000000 (8 бит)
- Датчик веса инициализируется с калибровочным коэффициентом
- Проверка переполненности резервуара только по запросу
- Автоматическое обнуление датчика при инициализации

### Результат
- ✅ 8 входных пинов с битовой маской
- ✅ Полный функционал датчика веса HX711
- ✅ Мониторинг переполненности резервуара
- ✅ 12 новых команд для мониторинга и весов
- ✅ Компиляция: RAM 52.7%, Flash 9.0%

---

## [2024-12-19] - Исправление проблемы с обработкой команд

### Исправлено
- Исправлена проблема с командой `help` - теперь команда корректно обрабатывается
- Добавлена очистка входящих команд от символов `\r` и `\n` в функции `processCommand()`
- Все команды теперь корректно распознаются независимо от терминала
- Улучшена обработка входящих команд с дополнительными символами

### Технические детали
- Добавлена функция очистки команд от управляющих символов
- Использование `cleanCommand` вместо исходной команды во всех сравнениях
- Защита от переполнения буфера при копировании команд
- Удаление пробелов в конце команд

### Результат
- ✅ Команда `help` теперь работает корректно
- ✅ Все команды распознаются правильно
- ✅ Улучшена совместимость с различными терминалами
- ✅ Система более устойчива к некорректному вводу
- ✅ Устранены все предупреждения компилятора
- ✅ Финальная компиляция: RAM 37.5%, Flash 8.0%

---

## [2024-12-19] - Добавление новых команд управления

### Добавлено
- Полный список команд управления с примерами использования
- Команда `help` для вывода справки по всем командам
- Команда `version` для отображения версии системы
- Команда `pin [index] [state]` для управления контрольными пинами
- Команда `emergency` для активации аварийной остановки
- Команда `enable` для включения всех моторов
- Команда `disable` для отключения временных моторов
- Функция `printHelp()` с подробным описанием всех команд
- Функция `printVersion()` для отображения информации о системе
- Функция `controlPin()` для управления выходными пинами
- Таблица индексов контрольных пинов в README

### Изменено
- Обновлен раздел команд в README.md с полным описанием
- Улучшена функция `setup()` с подробным выводом доступных команд
- Расширена функция `processCommand()` для обработки новых команд

### Результат
- ✅ Система поддерживает 15 различных команд
- ✅ Полная документация всех команд с примерами
- ✅ Удобная справка через команду `help`
- ✅ Управление всеми 10 контрольными пинами

---

## [2024-12-19] - Успешная компиляция и финальные исправления

### Исправлено
- Добавлены предварительные объявления функций для устранения ошибок компиляции
- Все ошибки компиляции устранены
- Система успешно компилируется без ошибок

### Результат
- ✅ Компиляция прошла успешно
- ✅ Использовано RAM: 23.0% (1883 байт из 8192)
- ✅ Использовано Flash: 5.8% (14824 байт из 253952)
- ✅ Система готова к загрузке на Arduino Mega 2560

---

## [2024-12-19] - Исправление ошибок компиляции и интеграция GyverStepper

### Исправлено
- Исправлены ошибки компиляции связанные с неправильным использованием шаблонных классов
- Заменены неправильные объявления `Stepper` и `GPlanner` на корректные согласно документации GyverStepper
- Исправлены вызовы методов для работы с планировщиком движения
- Добавлены недостающие функции `setup()` и `loop()`
- Исправлены вызовы методов для управления моторами
- Исправлены объявления объектов Stepper согласно примеру использования GyverPlanner
- Убраны несуществующие методы enable() и disable() из GyverStepper
- Добавлено правильное управление пинами enable через digitalWrite()

### Добавлено
- Полная интеграция библиотеки GyverStepper v2.7.0
- Система обработки команд через Serial
- Функции парсинга команд движения и homing
- Система вывода статуса системы
- Обработка аварийных ситуаций и таймаутов
- Правильная инициализация пинов enable моторов

### Изменено
- Обновлена структура проекта для использования GyverStepper вместо GyverPlanner
- Изменены объявления объектов моторов и планировщика
- Обновлены вызовы методов согласно API GyverStepper
- Исправлены конструкторы Stepper для использования только step и dir пинов
- Добавлено управление питанием моторов через пины enable

### Технические детали
- Использована библиотека GyverStepper v2.7.0
- Поддержка 5 шаговых двигателей с STEPPER2WIRE драйверами
- Интеграция с GPlanner для координации движения
- Система безопасности с таймаутами и аварийной остановкой
- Правильное управление питанием моторов через enable пины

### Известные проблемы
- ~~Требуется дополнительная настройка шаблонных параметров для классов STEPPER и GPlanner2~~
- ~~Необходимо проверить совместимость с конкретной версией библиотеки GyverStepper~~
- Все основные ошибки компиляции исправлены
- Система готова к тестированию
