# Компоненты пользовательского интерфейса

Этот модуль содержит специализированные компоненты для управления различными аспектами приложения.

## Архитектура

```
MainWindow (Координатор)
├── EventBus (Централизованные события)
├── NavigationManager (Управление навигацией)
├── PageManager (Жизненный цикл страниц)
└── ConnectionManager (Serial подключения)
```

## Компоненты

### EventBus

Централизованная система событий для координации компонентов приложения.

**Основные возможности:**
- Подписка/отписка на события
- Асинхронная и синхронная отправка событий
- Очередь событий для обработки
- Автоматическая очистка ресурсов

**Пример использования:**
```python
from ui.components.event_bus import event_bus

# Подписка на событие
event_bus.subscribe("connection_status_changed", my_handler)

# Отправка события
event_bus.emit("page_changed", page_name="wizard")
```

### NavigationManager

Управляет навигацией между страницами приложения.

**Основные возможности:**
- Переключение между страницами
- Управление состоянием навигационных кнопок
- История навигации
- События изменения страниц

**Пример использования:**
```python
from ui.components.navigation_manager import NavigationManager

nav_manager = NavigationManager(content_area)
nav_manager.switch_page("wizard")
nav_manager.go_back()
```

### PageManager

Управляет жизненным циклом страниц приложения.

**Основные возможности:**
- Создание страниц через фабрики
- Обновление и очистка страниц
- Автоматическое управление ресурсами
- События жизненного цикла страниц

**Пример использования:**
```python
from ui.components.page_manager import PageManager

page_manager = PageManager(content_area)

# Регистрация фабрики
page_manager.register_page_factory("wizard", WizardPage)

# Создание страницы
page = page_manager.create_page("wizard", config)
```

### ConnectionManager

Управляет Serial подключениями и состоянием соединения.

**Основные возможности:**
- Подключение/отключение от портов
- Мониторинг состояния подключения
- Автоподключение
- Обработка ошибок подключения

**Пример использования:**
```python
from ui.components.connection_manager import ConnectionManager

conn_manager = ConnectionManager(serial_manager, status_bar)
conn_manager.connect_to_port("COM1", settings)
conn_manager.enable_auto_connect(True)
```

## Принципы проектирования

### 1. Единственная ответственность (Single Responsibility)
Каждый компонент отвечает только за одну область функциональности.

### 2. Слабая связанность (Loose Coupling)
Компоненты общаются через EventBus, не имея прямых зависимостей друг от друга.

### 3. Высокая когезия (High Cohesion)
Внутри каждого компонента функциональность тесно связана и логически сгруппирована.

### 4. Инверсия зависимостей (Dependency Inversion)
Компоненты зависят от абстракций (EventBus), а не от конкретных реализаций.

## События EventBus

### Основные события

| Событие | Описание | Параметры |
|---------|----------|-----------|
| `connection_status_changed` | Изменение статуса подключения | `status`, `message` |
| `page_changed` | Изменение текущей страницы | `page_name` |
| `sequence_started` | Запуск последовательности | `sequence_name` |
| `sequence_finished` | Завершение последовательности | `success`, `message` |
| `command_executed` | Выполнение команды | `command`, `success` |
| `config_reloaded` | Перезагрузка конфигурации | - |
| `error_occurred` | Возникновение ошибки | `error_type`, `message` |

### События навигации

| Событие | Описание | Параметры |
|---------|----------|-----------|
| `page_change_requested` | Запрос изменения страницы | `page_name` |
| `navigation_reset` | Сброс навигации | - |

### События страниц

| Событие | Описание | Параметры |
|---------|----------|-----------|
| `page_created` | Создание страницы | `page_name`, `page_widget` |
| `page_refreshed` | Обновление страницы | `page_name` |
| `page_cleaned` | Очистка страницы | `page_name` |

### События подключения

| Событие | Описание | Параметры |
|---------|----------|-----------|
| `connect_requested` | Запрос подключения | `port`, `settings` |
| `disconnect_requested` | Запрос отключения | - |
| `auto_connect_enabled` | Включение автоподключения | - |
| `auto_connect_disabled` | Выключение автоподключения | - |

## Миграция с монолитного MainWindow

### До рефакторинга
```python
class MainWindow(QMainWindow):
    def __init__(self):
        # Вся логика в одном классе
        self._setup_ui()
        self._setup_connections()
        self._setup_navigation()
        # ... много других методов
```

### После рефакторинга
```python
class MainWindow(QMainWindow):
    def __init__(self):
        # Инициализация компонентов
        self._init_components()
        
        # Настройка координации
        self._setup_coordination()
        
        # UI остается простым
        self._setup_ui()
```

## Преимущества новой архитектуры

1. **Модульность**: Каждый компонент можно разрабатывать и тестировать независимо
2. **Переиспользование**: Компоненты можно использовать в других частях приложения
3. **Тестируемость**: Легче писать unit-тесты для отдельных компонентов
4. **Расширяемость**: Новые функции добавляются через новые компоненты
5. **Поддерживаемость**: Код легче понимать и модифицировать
6. **Разделение ответственности**: Каждый компонент имеет четкую зону ответственности

## Рекомендации по использованию

1. **Всегда используйте EventBus** для коммуникации между компонентами
2. **Не создавайте прямые зависимости** между компонентами
3. **Используйте сигналы Qt** только для UI-событий внутри компонента
4. **Обрабатывайте ошибки** на уровне каждого компонента
5. **Очищайте ресурсы** при закрытии компонентов
6. **Документируйте API** каждого компонента
7. **Пишите тесты** для каждого компонента отдельно
