# Руководство по решению проблем

## Проблемы с питанием двигателей

### Симптомы: Двигатели E0/E1 не двигаются, нет напряжения на enable пинах

#### Диагностика
1. **Проверьте состояние enable пинов:**
   ```
   check_enable_pins
   ```
   
   **Ожидаемые значения** после инициализации:
   - Multi, Multizone, RRight (постоянное питание): **LOW** (0V) - активны
   - E0, E1 (временное питание): **HIGH** (5V) - неактивны до команды движения

2. **Проверьте настройки в config.h:**
   ```cpp
   #define E0_POWER_ALWAYS_ON false  // для временного питания
   #define E1_POWER_ALWAYS_ON false  // для временного питания
   ```

#### Возможные причины и решения

**1. Неправильная настройка типа питания**
- **Симптом**: Двигатели E0/E1 не двигаются
- **Решение**: Убедиться, что используется `false` для временного питания
- **Проверка**: При выполнении команды `move_e0 100` должны видеть:
  ```
  Enable pin 24: ВКЛЮЧЕН (режим: временный)
  // движение
  Enable pin 24: ВЫКЛЮЧЕН (временный режим)
  ```

**2. Проблема в логике инициализации**
- **Симптом**: Enable пины показывают LOW даже для временных двигателей
- **Решение**: Убедиться, что функция `applyStepperConfig` отключает временные двигатели
- **Проверка**: В Serial Monitor при инициализации должно быть:
  ```
  E0: [НАСТРОЕН, ВРЕМЕННОЕ ПИТАНИЕ - ВЫКЛЮЧЕН]
  E1: [НАСТРОЕН, ВРЕМЕННОЕ ПИТАНИЕ - ВЫКЛЮЧЕН]
  ```

**3. Проблемы с библиотекой GyverStepper2**
- **Симптом**: Enable пины всегда показывают HIGH
- **Решение**: Проверить вызов `stepper.enable()` перед движением в `enableStepper()`
- **Проверка**: Убедиться что pinMode для enable пинов НЕ устанавливается вручную

### Логика работы временного питания

#### Правильная последовательность для временных двигателей (E0/E1):

1. **Инициализация**: 
   - `stepper.enable()` → включить для настройки
   - Настройка параметров
   - `stepper.disable()` → выключить после настройки

2. **Выполнение команды**:
   - `enableStepper()` → включить перед движением  
   - Движение к позиции
   - `disableStepper()` → выключить после завершения

#### Пошаговое исправление временного питания

1. **Откройте файл `include/config.h`**
2. **Убедитесь в настройках:**
   ```cpp
   #define E0_POWER_ALWAYS_ON false  // временное питание
   #define E1_POWER_ALWAYS_ON false  // временное питание
   ```
3. **Перекомпилируйте и загрузите:**
   ```
   pio run
   pio run --target upload
   ```
4. **Проверьте инициализацию в Serial Monitor:**
   ```
   E0: [НАСТРОЕН, ВРЕМЕННОЕ ПИТАНИЕ - ВЫКЛЮЧЕН]
   E1: [НАСТРОЕН, ВРЕМЕННОЕ ПИТАНИЕ - ВЫКЛЮЧЕН] 
   ```
5. **Проверьте состояние enable пинов:**
   ```
   check_enable_pins
   ```
   E0 и E1 должны показывать HIGH
6. **Протестируйте движение:**
   ```
   move_e0 100
   ```
   Должны видеть включение → движение → выключение

## Проблемы с движением двигателей

### Симптомы: Двигатели гудят, но не двигаются

#### Возможные причины
1. **Слишком низкая скорость** - установите минимум 300 steps/sec
2. **Перегрузка двигателя** - уменьшите нагрузку или увеличьте ток
3. **Неправильная последовательность фаз** - проверьте подключение катушек

### Симптомы: Двигатели двигаются не в ту сторону

#### Решение
1. **Поменяйте полярность DIR пина в config.h** или
2. **Физически поменяйте провода одной катушки**

## Проблемы с концевыми выключателями

### Симптомы: Хоминг не срабатывает или срабатывает неправильно

#### Проверка типа датчика
```cpp
#define MOTOR_ENDSTOP_TYPE_NPN true   // для NPN датчиков
#define MOTOR_ENDSTOP_TYPE_NPN false  // для PNP датчиков
```

#### Диагностика датчиков
```
check_all_endstops          // проверка всех концевиков
check_multi_endstop         // проверка конкретного датчика
```

## Общие рекомендации

### При внесении изменений в config.h:
1. **Всегда делайте резервную копию** рабочей конфигурации
2. **Изменяйте по одному параметру** за раз
3. **Тестируйте после каждого изменения**
4. **Документируйте рабочие настройки**

### Полезные команды для диагностики:
- `test` - проверка связи
- `check_enable_pins` - состояние питания двигателей  
- `check_all_endstops` - состояние всех датчиков
- `move_multi 100` - тест движения небольшого двигателя
- `move_e0 100` - тест движения E0
- `move_e1 100` - тест движения E1 