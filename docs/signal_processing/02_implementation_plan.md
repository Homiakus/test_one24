# Система обработки входящих сигналов UART - План реализации

## Этап 1: Анализ и проектирование

### 1.1 Анализ требований
- [x] Определение структуры конфигурации сигналов
- [x] Анализ интеграции с существующей системой
- [x] Проектирование архитектуры компонентов

### 1.2 Проектирование архитектуры
- [ ] Создание диаграммы компонентов
- [ ] Определение интерфейсов
- [ ] Планирование интеграции с UART

### 1.3 Планирование интеграции
- [ ] Определение точек интеграции с SerialManager
- [ ] Планирование интеграции с FlagManager
- [ ] Планирование UI компонентов

## Этап 2: Инфраструктура обработки сигналов

### 2.1 Создание типов данных
- [ ] `SignalType` - enum типов данных
- [ ] `SignalInfo` - информация о сигнале
- [ ] `SignalMapping` - маппинг сигнал → переменная
- [ ] `SignalValue` - значение сигнала с типом

### 2.2 Создание интерфейсов
- [ ] `ISignalProcessor` - интерфейс обработчика сигналов
- [ ] `ISignalValidator` - интерфейс валидатора
- [ ] `ISignalManager` - интерфейс менеджера сигналов

### 2.3 Создание базовых компонентов
- [ ] `SignalProcessor` - обработка входящих данных
- [ ] `SignalValidator` - валидация данных
- [ ] `SignalManager` - главный менеджер сигналов

## Этап 3: Конфигурация и парсинг

### 3.1 Расширение ConfigLoader
- [ ] Добавление поддержки секции `signals`
- [ ] Парсинг конфигурации сигналов
- [ ] Валидация конфигурации

### 3.2 Создание парсера сигналов
- [ ] `SignalConfigParser` - парсинг config.toml
- [ ] `SignalTypeParser` - парсинг типов данных
- [ ] `SignalMappingParser` - парсинг маппингов

### 3.3 Валидация конфигурации
- [ ] Проверка корректности типов данных
- [ ] Проверка уникальности сигналов
- [ ] Проверка корректности маппингов

## Этап 4: Интеграция с UART системой

### 4.1 Расширение SerialManager
- [ ] Добавление обработчиков входящих данных
- [ ] Интеграция с SignalProcessor
- [ ] Обработка ошибок парсинга

### 4.2 Создание обработчиков сигналов
- [ ] `FloatSignalHandler` - обработка float значений
- [ ] `IntSignalHandler` - обработка int значений
- [ ] `StringSignalHandler` - обработка string значений
- [ ] `BoolSignalHandler` - обработка bool значений
- [ ] `JsonSignalHandler` - обработка JSON значений

### 4.3 Интеграция с FlagManager
- [ ] Автоматическое обновление флагов
- [ ] Синхронизация переменных
- [ ] Обработка конфликтов

## Этап 5: UI интеграция

### 5.1 Создание панели мониторинга сигналов
- [ ] `SignalMonitorPanel` - панель мониторинга
- [ ] Отображение текущих значений
- [ ] История изменений

### 5.2 Интеграция с информационной панелью
- [ ] Добавление секции сигналов
- [ ] Real-time обновление значений
- [ ] Статистика сигналов

### 5.3 Создание страницы настройки сигналов
- [ ] `SignalsPage` - страница настройки
- [ ] Редактирование конфигурации
- [ ] Тестирование сигналов

## Этап 6: Тестирование и документация

### 6.1 Создание unit тестов
- [ ] Тесты SignalProcessor
- [ ] Тесты SignalValidator
- [ ] Тесты SignalManager
- [ ] Тесты обработчиков типов

### 6.2 Создание integration тестов
- [ ] Тесты интеграции с SerialManager
- [ ] Тесты интеграции с FlagManager
- [ ] Тесты полного workflow

### 6.3 Обновление документации
- [ ] Документация API
- [ ] Руководство пользователя
- [ ] Примеры конфигурации

## Детали реализации

### Структура файлов
```
core/
├── signal_types.py          # Типы данных сигналов
├── signal_manager.py        # Главный менеджер сигналов
├── signal_processor.py      # Обработка сигналов
├── signal_validator.py      # Валидация сигналов
└── signal_handlers/         # Обработчики типов данных
    ├── __init__.py
    ├── float_handler.py
    ├── int_handler.py
    ├── string_handler.py
    ├── bool_handler.py
    └── json_handler.py

ui/
├── pages/
│   └── signals_page.py      # Страница настройки сигналов
└── widgets/
    └── signal_monitor.py    # Панель мониторинга сигналов
```

### Пример конфигурации config.toml
```toml
[signals]
# Температура устройства
"TEMP" = "device_temperature (float)"

# Статус устройства
"STATUS" = "device_status (string)"

# Код ошибки
"ERROR" = "error_code (int)"

# Давление в системе
"PRESSURE" = "system_pressure (float)"

# Режим работы
"MODE" = "operation_mode (string)"

# Флаг готовности
"READY" = "device_ready (bool)"

# Конфигурация устройства
"CONFIG" = "device_config (json)"
```

### Пример входящих данных UART
```
TEMP:25.5
STATUS:running
ERROR:0
PRESSURE:1.2
MODE:normal
READY:true
CONFIG:{"version":"1.0","mode":"auto"}
```

## Критерии готовности

### Этап 1: Анализ и проектирование
- [ ] Анализ требований завершен
- [ ] Архитектура спроектирована
- [ ] План интеграции создан

### Этап 2: Инфраструктура обработки сигналов
- [ ] Все типы данных созданы
- [ ] Все интерфейсы определены
- [ ] Базовые компоненты реализованы

### Этап 3: Конфигурация и парсинг
- [ ] ConfigLoader расширен
- [ ] Парсер сигналов работает
- [ ] Валидация конфигурации работает

### Этап 4: Интеграция с UART системой
- [ ] SerialManager интегрирован
- [ ] Обработчики сигналов работают
- [ ] FlagManager интегрирован

### Этап 5: UI интеграция
- [ ] Панель мониторинга создана
- [ ] Информационная панель обновлена
- [ ] Страница настройки работает

### Этап 6: Тестирование и документация
- [ ] Unit тесты созданы и проходят
- [ ] Integration тесты созданы и проходят
- [ ] Документация обновлена
