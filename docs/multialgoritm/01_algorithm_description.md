# Мультизональный алгоритм - Описание

## Обзор
Мультизональный алгоритм позволяет выполнять команды для нескольких выбранных зон одновременно, используя битовую маску для определения активных зон.

## Основные принципы

### 1. Выбор зон
- Пользователь выбирает зоны через UI (4 зоны: 1, 2, 3, 4)
- Выбор зон преобразуется в битовую маску
- Примеры битовых масок:
  - Зона 1: 0001
  - Зоны 1,2: 0011
  - Зоны 1,3: 0101
  - Зоны 1,2,3,4: 1111

### 2. Мультизональные команды
- Команды с префиксом `og_multizone-` обрабатываются специально
- Если в названии команды есть `multizone`, выполняется прохождение по всем активным битам
- Количество повторений = количество активных битов в маске

### 3. Логика выполнения
Для каждой активной зоны:
1. Отправляется команда `multizone` с битовой маской для конкретной зоны
2. Выполняется основная команда

## Примеры выполнения

### Пример 1: Битовые маски для отдельных зон
- Зона 1: `multizone 0001`
- Зона 2: `multizone 0010`
- Зона 3: `multizone 0100`
- Зона 4: `multizone 1000`

### Пример 2: Команда `og_multizone-test` с маской 0110
Выполняется 2 раза (2 активных бита):
1. `multizone 0100` (зона 3)
2. `og_multizone-test`
3. `multizone 0010` (зона 2)
4. `og_multizone-test`

### Пример 3: Команда `og_multizone-paint` с маской 1111
Выполняется 4 раза (4 активных бита):
1. `multizone 1000` (зона 4)
2. `og_multizone-paint`
3. `multizone 0100` (зона 3)
4. `og_multizone-paint`
5. `multizone 0010` (зона 2)
6. `og_multizone-paint`
7. `multizone 0001` (зона 1)
8. `og_multizone-paint`

## Глобальные переменные

### Переменные состояния зон
```python
zone_mask = 0b0000  # Текущая битовая маска зон
active_zones = []   # Список активных зон (1-4)
zone_count = 0      # Количество активных зон
```

### Переменные влияния на UI
```python
ui_zone_selection = {}  # Состояние выбора зон в UI
ui_zone_buttons = {}    # Ссылки на кнопки выбора зон
ui_zone_status = {}     # Статус выполнения для каждой зоны
```

## Интеграция с существующей системой

### Влияние на UI
- Кнопки выбора зон обновляют глобальные переменные
- Статус выполнения отображается для каждой зоны
- Прогресс-бар показывает общий прогресс по всем зонам

### Влияние на процесс выполнения
- Последовательности команд могут включать мультизональные команды
- Условное выполнение учитывает состояние зон
- Логирование включает информацию о выполняемых зонах

## Безопасность и валидация

### Проверки
- Валидация битовой маски (0-15)
- Проверка корректности выбора зон
- Контроль максимального количества одновременных операций

### Обработка ошибок
- Логирование ошибок для каждой зоны
- Возможность остановки выполнения для конкретной зоны
- Восстановление состояния при сбоях
